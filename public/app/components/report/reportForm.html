<div class="panel panel-primary">
    <!-- Default panel contents -->
    <div class="panel-heading">
        <strong>{{reportForm.title}}</strong>
        <button class="btn btn-xs btn-default pull-right " ng-click="reportForm.toggleGroupPanel()"><i class="fa fa-group"></i> Group</button>
    </div>

    <alert ng-repeat="alert in reportForm.alerts" type="{{alert.type}}" close="reportForm.closeAlert($index)">{{alert.msg}}</alert>

    <div style="padding:30px">

        <div collapse="!reportForm.groupPanel">
            <div class="well">
                <div class="form-group">
                    <h4>Group</h4>
                    <ui-select ng-model="reportForm.group" theme="bootstrap">
                        <ui-select-match placeholder="Select or search a group in the list...">{{$select.selected.name}}</ui-select-match>
                        <ui-select-choices repeat="group in reportForm.groups | filter: $select.search">
                            <span ng-bind-html="group.name | highlight: $select.search"></span>
                        </ui-select-choices>
                    </ui-select>
                </div>

                <div class="form-group">
                    <button class="btn btn-primary" ng-disabled="!reportForm.group" ng-click="reportForm.loadGroup()"
                            confirm="Loading the group will override the current settings. Are you sure?"><i class="fa fa-download"></i> Load</button>
                    <button class="btn btn-primary" ng-disabled="!reportForm.group" ng-click="reportForm.saveGroup()"
                            confirm="Group will be overridden with the current settings. Are you sure?"><i class="fa fa-upload"></i> Save</button>
                </div>

                <div class="form-group">
                    <div class="input-group">
                        <input type="text" class="form-control" ng-model="reportForm.newGroupName" placeholder="Enter name..."/>
                        <span class="input-group-btn">
                            <button class="btn btn-primary" ng-disabled="!reportForm.newGroupName" ng-click="reportForm.saveNewGroup()">
                                <i class="fa fa-plus-square"></i> Save as new
                            </button>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <form class="form-horizontal">

            <div class="form-group">
                <label for="name" class="col-sm-1 control-label">Name</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="name" placeholder="Name" ng-model="reportForm.report.name" ng-required="true">
                </div>
            </div>

            <div class="form-group" ng-show="reportForm.report.evaluated_at">
                <label for="evaluatedAt" class="col-sm-1 control-label">Evaluated at</label>
                <div class="col-sm-10">
                    <input type="datetime-local" ng-disabled="true" class="form-control" id="evaluatedAt" ng-model="reportForm.report.evaluated_at">
                </div>
            </div>

            <div class="row">
                <div class="col-sm-offset-1 col-sm-5">
                    <h4>Start date</h4>
                    <p class="input-group">
                        <input type="date" class="form-control" datepicker-popup ng-model="reportForm.report.start_date"
                               is-open="reportForm.datepicker.status.opened" ng-required="true"
                               datepicker-options="reportForm.datepicker.options" close-text="Close"/>
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-default" ng-click="reportForm.datepicker.open($event)"><i class="fa fa-calendar"></i></button>
                        </span>

                    </p>
                </div>

                <div class="col-sm-5">
                    <h4>End date</h4>
                    <p class="input-group">
                        <input type="date" class="form-control" datepicker-popup ng-model="reportForm.report.end_date"
                               is-open="reportForm.datepicker.status.opened" ng-required="true"
                               datepicker-options="reportForm.datepicker.options" close-text="Close"/>
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-default" ng-click="reportForm.datepicker.open($event)"><i class="fa fa-calendar"></i></button>
                        </span>

                    </p>
                </div>
            </div>

            <div class="row">

                <div class="col-sm-offset-1 col-sm-5">
                    <h4>Users</h4>
                    <accordion close-others="false">

                        <accordion-group heading="Selected" is-open="true">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>View self</th>
                                        <th>View all</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="user in reportForm.report.users">
                                        <td>
                                            {{user.name}} {{user.surname}}
                                        </td>
                                        <td><input type="checkbox" ng-model="user.pivot.view_self"></td>
                                        <td><input type="checkbox" ng-model="user.pivot.view_all"></td>
                                        <td><button class="btn btn-xs btn-danger pull-right" ng-click="reportForm.removeUser($index)"><i class="fa fa-minus"></i></button></td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                <tr>
                                    <td><strong>Toggle all</strong></td>
                                    <td>
                                        <button class="btn btn-xs bg-plain" ng-click="reportForm.toggles.users.self.toggle()">
                                            <i ng-class="['fa', {'fa-toggle-on': reportForm.toggles.users.self.state, 'fa-toggle-off': !reportForm.toggles.users.self.state}]"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <button class="btn btn-xs bg-plain" ng-click="reportForm.toggles.users.all.toggle()">
                                            <i ng-class="['fa', {'fa-toggle-on': reportForm.toggles.users.all.state, 'fa-toggle-off': !reportForm.toggles.users.all.state}]"></i>
                                        </button>
                                    </td>
                                    <td></td>
                                </tr>
                                </tfoot>
                            </table>
                        </accordion-group>

                        <accordion-group heading="Available">
                            <table class="table">
                                <tbody>
                                <tr ng-repeat="user in reportForm.users">
                                    <td>
                                        {{user.name}} {{user.surname}} <button class="btn btn-xs btn-success pull-right" ng-click="reportForm.addUser($index)"><i class="fa fa-plus"></i></button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </accordion-group>

                    </accordion>
                </div>

                <div class="col-sm-5">
                    <h4>Indicators</h4>
                    <accordion close-others="false">

                        <accordion-group heading="Selected" is-open="true">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Value</th>
                                        <th>Points</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="indicator in reportForm.report.indicators">
                                        <td>
                                            {{indicator.name}}
                                        </td>
                                        <td><input type="checkbox" ng-model="indicator.pivot.show_value"></td>
                                        <td><input type="checkbox" ng-model="indicator.pivot.show_points"></td>
                                        <td><button class="btn btn-xs btn-danger pull-right" ng-click="reportForm.removeIndicator($index)"><i class="fa fa-minus"></i></button></td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td><strong>Toggle all</strong></td>
                                        <td>
                                            <button class="btn btn-xs bg-plain" ng-click="reportForm.toggles.indicators.value.toggle()">
                                                <i ng-class="['fa', {'fa-toggle-on': reportForm.toggles.indicators.value.state, 'fa-toggle-off': !reportForm.toggles.indicators.value.state}]"></i>
                                            </button>
                                        </td>
                                        <td>
                                            <button class="btn btn-xs bg-plain" ng-click="reportForm.toggles.indicators.points.toggle()">
                                            <i ng-class="['fa', {'fa-toggle-on': reportForm.toggles.indicators.points.state, 'fa-toggle-off': !reportForm.toggles.indicators.points.state}]"></i>
                                            </button>
                                        </td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </accordion-group>

                        <accordion-group heading="Available">
                            <table class="table">
                                <tbody>
                                <tr ng-repeat="indicator in reportForm.indicators">
                                    <td>
                                        {{indicator.name}} <button class="btn btn-xs btn-success pull-right" ng-click="reportForm.addIndicator($index)"><i class="fa fa-plus"></i></button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </accordion-group>

                    </accordion>
                </div>

            </div>

            <div class="form-group">
                <div class="col-sm-offset-1 col-sm-10">
                    <button class="btn btn-primary" ng-click="reportForm.save()"><i class="fa fa-upload"></i> Save</button>
                    <button class="btn btn-primary" ng-click="reportForm.preview()"><i class="fa fa-search"></i> Preview template</button>
                    <button ng-class="['btn', {'btn-warning': !reportForm.report.evaluated_at, 'btn-success': reportForm.report.evaluated_at}]" ng-disabled="!reportForm.report.evaluated_at" ng-click="reportForm.view()"><i class="fa fa-table"></i> View results</button>
                    <button class="btn btn-warning" ng-show="reportForm.report.evaluated_at" ng-click="reportForm.generate()" confirm="Are you sure you want to recalculate this report? Previous results will be lost."><i class="fa fa-cog"></i> Generate</button>
                    <button class="btn btn-success" ng-hide="reportForm.report.evaluated_at" ng-click="reportForm.generate()"><i class="fa fa-cog"></i> Generate</button>
                </div>
            </div>

        </form>



    </div>


    <div class="panel-footer">
        <a role="button" ui-sref="reports"><i class="fa fa-arrow-circle-left"></i> Reports</a>
    </div>

</div>